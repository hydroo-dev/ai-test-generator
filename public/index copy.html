<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Case Generator - With Detailed Steps</title>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 20, 40, 0.08);
            overflow: hidden;
            border: 2px solid #0a2540;
        }

        .header {
            background: white;
            color: #0a2540;
            padding: 40px;
            text-align: center;
            border-bottom: 2px solid #0a2540;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #0a2540;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1em;
            color: #2d3e5f;
        }

        .content {
            padding: 40px;
            background: white;
        }

        .input-section {
            margin-bottom: 30px;
            background: #f8fafc;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #0a2540;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
            font-family: inherit;
            background: white;
            color: #0a2540;
        }

        textarea:focus {
            outline: none;
            border-color: #2dc4b6;
            box-shadow: 0 0 0 3px rgba(45, 196, 182, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            background: white;
            color: #0a2540;
            border: 2px solid #0a2540;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: #0a2540;
            color: white;
            border-color: #0a2540;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(10, 37, 64, 0.15);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: white;
            color: #94a3b8;
            border-color: #94a3b8;
        }

        button.secondary {
            background: white;
            color: #2dc4b6;
            border-color: #2dc4b6;
        }

        button.secondary:hover {
            background: #2dc4b6;
            color: white;
            border-color: #2dc4b6;
            box-shadow: 0 4px 12px rgba(45, 196, 182, 0.2);
        }

        button.outline {
            background: white;
            color: #2dc4b6;
            border: 2px solid #2dc4b6;
        }

        button.outline:hover {
            background: #2dc4b6;
            color: white;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
            padding: 40px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .loading-spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #2dc4b6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: #2d3e5f;
            font-size: 1.1em;
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .feature-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            color: #0a2540;
            border: 2px solid #0a2540;
            box-shadow: 0 4px 12px rgba(10, 37, 64, 0.05);
        }

        .feature-box h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #2dc4b6;
            font-weight: 600;
        }

        .feature-box p {
            font-size: 1.3em;
            font-weight: 500;
            line-height: 1.5;
            color: #0a2540;
        }

        .test-cases {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e2e8f0;
        }

        .test-cases-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .test-cases-header h3 {
            color: #0a2540;
            font-size: 1.4em;
            font-weight: 600;
        }

        .test-cases-header .badge {
            background: #2dc4b6;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .test-case-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            transition: all 0.2s;
        }

        .test-case-card:hover {
            border-color: #2dc4b6;
            box-shadow: 0 8px 16px rgba(45, 196, 182, 0.1);
        }

        .test-case-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .test-case-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #0a2540;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-case-number {
            background: #2dc4b6;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: 600;
        }

        .test-case-category {
            color: #2dc4b6;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
            background: #f0fdfa;
            border: 1px solid #2dc4b6;
        }

        .test-case-content {
            margin-bottom: 15px;
        }

        .test-case-preconditions {
            background: #f8fafc;
            border-left: 4px solid #2dc4b6;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 0.95em;
            color: #0a2540;
        }

        .test-case-preconditions strong {
            color: #0a2540;
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .test-case-steps {
            background: #f8fafc;
            border-left: 4px solid #0a2540;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            color: #0a2540;
        }

        .test-case-steps strong {
            color: #0a2540;
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .test-case-steps ol {
            margin-left: 20px;
            color: #2d3e5f;
        }

        .test-case-steps li {
            margin-bottom: 5px;
        }

        .test-case-expected {
            background: #f8fafc;
            border-left: 4px solid #2dc4b6;
            padding: 12px 15px;
            border-radius: 4px;
            color: #0a2540;
        }

        .test-case-expected strong {
            color: #0a2540;
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .test-case-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .test-case-actions button {
            padding: 8px 16px;
            font-size: 14px;
        }

        .code-block {
            background: #f8fafc;
            color: #0a2540;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0 20px;
            display: none;
            position: relative;
            border: 2px solid #0a2540;
        }

        .code-block pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            line-height: 1.5;
            color: #0a2540;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            color: #0a2540;
            border: 2px solid #0a2540;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-button:hover {
            background: #0a2540;
            color: white;
        }

        .error-message {
            background: #fff5f5;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #fc8181;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            color: #2d3e5f;
            font-size: 0.9em;
            justify-content: flex-end;
        }

        .example-prompts {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .example-prompt-chip {
            background: #f8fafc;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
            color: #0a2540;
            border: 1px solid #e2e8f0;
        }

        .example-prompt-chip:hover {
            background: #2dc4b6;
            color: white;
            border-color: #2dc4b6;
        }

        .connection-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            display: none;
        }

        .connection-status.success {
            background: #f0fdfa;
            color: #2dc4b6;
            display: block;
            border: 1px solid #2dc4b6;
        }

        .connection-status.error {
            background: #fff5f5;
            color: #c53030;
            display: block;
            border: 1px solid #fc8181;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" style="text-align:center;">

    <div style="display:flex; align-items:center; justify-content:center; gap:12px;">
        <img src="wired-outline-2512-artificial-intelligence-ai-alt.gif"
             style="height:65px; width:65px; object-fit:contain;">
        <h1 style="margin:0; font-size:45px; line-height:45px;">
            Test Case Generator
        </h1>
    </div>

    <p style="margin-top:12px; font-size:16px;">
        Describe your feature and get detailed test cases with step-by-step instructions
    </p>

</div>


        <div class="content">
            <div class="input-section">
                <label for="feature">üìù Describe the feature to test:</label>
                <textarea
                    id="feature"
                    rows="4"
                    placeholder="Example: A login page with email, password fields, remember me checkbox, and submit button. Include validation, error handling, and security features."
                ></textarea>

                <div class="example-prompts" id="examplePrompts"></div>

                <div class="button-group">
                    <button id="generateBtn">
                        <span>‚ú®</span> Generate Test Cases
                    </button>
                    <button id="testApiBtn" class="secondary">
                        <span>üîå</span> Test Connection
                    </button>
                    <button id="mockBtn" class="outline">
                        <span>üîÑ</span> Load Mock Data
                    </button>
                </div>

                <div id="connectionStatus" class="connection-status"></div>
            </div>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Generating detailed test cases with AI...</p>
                <small style="color: #999;">This may take 15-20 seconds</small>
            </div>

            <div class="results" id="results">
                <div class="feature-box">
                    <h3>üìã Feature Under Test:</h3>
                    <p id="displayedFeature"></p>
                </div>

                <div class="test-cases">
                    <div class="test-cases-header">
                        <h3>üß™ Generated Test Cases</h3>
                        <span class="badge" id="testCaseCount">0 test cases</span>
                    </div>

                    <div id="testCasesList"></div>

                    <div class="stats" id="stats">
                        <span id="modelInfo"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const generateBtn = document.getElementById('generateBtn');
        const testApiBtn = document.getElementById('testApiBtn');
        const mockBtn = document.getElementById('mockBtn');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const featureInput = document.getElementById('feature');
        const displayedFeature = document.getElementById('displayedFeature');
        const testCasesList = document.getElementById('testCasesList');
        const testCaseCount = document.getElementById('testCaseCount');
        const modelInfo = document.getElementById('modelInfo');
        const examplePrompts = document.getElementById('examplePrompts');
        const connectionStatus = document.getElementById('connectionStatus');

        // Get the base URL dynamically
        const baseUrl = window.location.origin;
        console.log('üîó Base URL:', baseUrl);

        // Example prompts
        const examples = [
            "Login page with email, password, remember me, and submit button. Include validation for empty fields, invalid credentials, and successful login.",
            "User registration form with username, email, password, confirm password, and terms acceptance. Include password strength validation and email format verification.",
            "Shopping cart with add/remove items, update quantity, apply discount code, and proceed to checkout. Test edge cases like empty cart and invalid codes.",
            "Search functionality with filters, sorting, pagination, and no results handling. Test with various search terms and filter combinations.",
            "File upload feature supporting images, with size limits, format validation, preview generation, and error handling for invalid files."
        ];

        // Populate example prompts
        examples.forEach(example => {
            const chip = document.createElement('span');
            chip.className = 'example-prompt-chip';
            chip.textContent = example.substring(0, 40) + '...';
            chip.title = example;
            chip.addEventListener('click', () => {
                featureInput.value = example;
            });
            examplePrompts.appendChild(chip);
        });

        // Test API Connection
        testApiBtn.addEventListener('click', async () => {
            try {
                testApiBtn.disabled = true;
                testApiBtn.innerHTML = '<span>‚è≥</span> Testing...';
                connectionStatus.style.display = 'none';

                console.log('üîç Testing connection to:', `${baseUrl}/api/health`);

                const response = await fetch(`${baseUrl}/api/health`);
                const data = await response.json();

                if (response.ok) {
                    connectionStatus.className = 'connection-status success';
                    connectionStatus.innerHTML = `‚úÖ Connected to ${baseUrl}<br>üìä Models available: ${data.availableModels?.length || 0}`;
                    console.log('‚úÖ API Health:', data);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                console.error('‚ùå Connection error:', error);
                connectionStatus.className = 'connection-status error';
                connectionStatus.innerHTML = `‚ùå Cannot connect to ${baseUrl}<br>Make sure server is running on port 3000<br>Error: ${error.message}`;
            } finally {
                testApiBtn.disabled = false;
                testApiBtn.innerHTML = '<span>üîå</span> Test Connection';
            }
        });

        // Load Mock Data
        mockBtn.addEventListener('click', async () => {
            const feature = featureInput.value.trim() || "Login page functionality";

            try {
                loading.style.display = 'block';
                results.style.display = 'none';
                connectionStatus.style.display = 'none';

                console.log('üì¶ Loading mock data for:', feature);

                const response = await fetch(`${baseUrl}/api/mock-tests?feature=${encodeURIComponent(feature)}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    displayTestCases(data.testCases, data.feature, 'Mock Data');
                } else {
                    throw new Error(data.error || 'Failed to load mock data');
                }
            } catch (error) {
                console.error('‚ùå Mock data error:', error);
                connectionStatus.className = 'connection-status error';
                connectionStatus.innerHTML = `‚ùå Error loading mock data: ${error.message}`;
            } finally {
                loading.style.display = 'none';
            }
        });

        // Parse test cases from AI response
        function parseTestCases(text) {
            const testCases = [];
            const lines = text.split('\n');

            let currentTestCase = null;
            let currentSection = null;
            let categoryStack = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                // Check for category headers like [POSITIVE], [NEGATIVE], etc.
                const categoryMatch = line.match(/\[([A-Z\s\/]+)\]/i);
                if (categoryMatch) {
                    const category = categoryMatch[1].trim();
                    categoryStack.push(category);
                    continue;
                }

                // Check for test case with pattern like "1. **[TITLE]**" or "1. [TITLE]"
                const testCaseMatch = line.match(/^(\d+)[\.\)]\s*\*{0,2}\[?([^\*\]]+)\]?\*{0,2}/);
                if (testCaseMatch) {
                    // Save previous test case
                    if (currentTestCase) {
                        if (categoryStack.length > 0 && currentTestCase.category === 'General') {
                            currentTestCase.category = categoryStack[categoryStack.length - 1];
                        }
                        testCases.push(currentTestCase);
                    }

                    // Start new test case
                    const title = testCaseMatch[2].replace(/^\*\*|\*\*$/g, '').trim();
                    currentTestCase = {
                        number: testCaseMatch[1],
                        title: title,
                        preconditions: '',
                        steps: [],
                        expected: '',
                        category: categoryStack.length > 0 ? categoryStack[categoryStack.length - 1] : 'General'
                    };
                    currentSection = null;
                    continue;
                }

                if (!currentTestCase) continue;

                // Check for sections
                const lowerLine = line.toLowerCase();

                if (lowerLine.includes('precondition') || lowerLine.startsWith('preconditions:')) {
                    currentSection = 'preconditions';
                    currentTestCase.preconditions = line.replace(/^preconditions?:?\s*/i, '').trim();
                }
                else if (lowerLine.includes('steps:') || lowerLine.includes('test steps:')) {
                    currentSection = 'steps';
                }
                else if (lowerLine.includes('expected') || lowerLine.includes('expected result:')) {
                    currentSection = 'expected';
                    currentTestCase.expected = line.replace(/^expected\s*(result)?:?\s*/i, '').trim();
                }
                else if (currentSection === 'steps') {
                    // Handle numbered steps
                    const stepMatch = line.match(/^(\d+)[\.\)]\s*(.+)/);
                    if (stepMatch) {
                        // New step
                        currentTestCase.steps.push(stepMatch[2].trim());
                    } else if (currentTestCase.steps.length > 0 && !line.match(/^(precondition|expected|steps)/i)) {
                        // Continuation of previous step
                        const lastStepIndex = currentTestCase.steps.length - 1;
                        currentTestCase.steps[lastStepIndex] = currentTestCase.steps[lastStepIndex] + ' ' + line;
                    }
                }
                else if (currentSection === 'expected' && !currentTestCase.expected) {
                    currentTestCase.expected = line;
                }
                else if (currentSection === 'preconditions' && !currentTestCase.preconditions) {
                    currentTestCase.preconditions = line;
                }
            }

            // Add last test case
            if (currentTestCase) {
                if (categoryStack.length > 0 && currentTestCase.category === 'General') {
                    currentTestCase.category = categoryStack[categoryStack.length - 1];
                }
                testCases.push(currentTestCase);
            }

            // Filter out any steps that might have been incorrectly added as test cases
            const filteredTestCases = testCases.filter(tc =>
                tc.title &&
                tc.title.length > 10 &&
                !tc.title.toLowerCase().includes('navigate to') &&
                !tc.title.toLowerCase().includes('click the') &&
                !tc.title.toLowerCase().includes('enter valid') &&
                !tc.title.toLowerCase().includes('select')
            );

            return filteredTestCases.length > 0 ? filteredTestCases : testCases;
        }

        // Get category color
        function getCategoryColor(category) {
            const categoryMap = {
                'POSITIVE': '#28a745',
                'NEGATIVE': '#dc3545',
                'EDGE': '#ffc107',
                'UI/UX': '#17a2b8',
                'PERFORMANCE': '#6f42c1',
                'SECURITY': '#fd7e14'
            };

            for (const [key, color] of Object.entries(categoryMap)) {
                if (category.toUpperCase().includes(key)) {
                    return color;
                }
            }
            return '#6c757d'; // Default gray
        }

        // Display test cases in UI
        function displayTestCases(testCasesText, feature, modelInfo_text = '') {
            displayedFeature.textContent = feature;

            const parsedTestCases = parseTestCases(testCasesText);

            if (parsedTestCases.length === 0) {
                testCasesList.innerHTML = `
                    <div class="test-case-card">
                        <div class="test-case-content">
                            <pre style="white-space: pre-wrap; font-family: inherit;">${testCasesText}</pre>
                        </div>
                    </div>
                `;
                testCaseCount.textContent = 'Raw output';
            } else {
                testCasesList.innerHTML = parsedTestCases.map((testCase, index) => {
                    const displayNumber = index + 1;
                    const categoryColor = getCategoryColor(testCase.category);

                    return `
                    <div class="test-case-card" id="test-case-${index}">
                        <div class="test-case-header">
                            <div class="test-case-title">
                                <span class="test-case-number">${displayNumber}</span>
                                ${testCase.title || 'Test Case'}
                            </div>
                            <span class="test-case-category" style="background: ${categoryColor}; color: white;">
                                ${testCase.category}
                            </span>
                        </div>

                        <div class="test-case-content">
                            ${testCase.preconditions ? `
                                <div class="test-case-preconditions">
                                    <strong>üìã Preconditions:</strong>
                                    ${testCase.preconditions}
                                </div>
                            ` : ''}

                            ${testCase.steps.length > 0 ? `
                                <div class="test-case-steps">
                                    <strong>üìù Steps:</strong>
                                    <ol start="1">
                                        ${testCase.steps.map(step => {
                                            return `<li>${step}</li>`;
                                        }).join('')}
                                    </ol>
                                </div>
                            ` : ''}

                            ${testCase.expected ? `
                                <div class="test-case-expected">
                                    <strong>‚úÖ Expected Result:</strong>
                                    ${testCase.expected}
                                </div>
                            ` : ''}
                        </div>

                        <div class="test-case-actions">
                            <button class="outline" onclick='generatePlaywrightCode(${index}, ${JSON.stringify(testCase).replace(/'/g, "\\'")})'>
                                <span>üé≠</span> Generate Playwright Code
                            </button>
                        </div>

                        <div class="code-block" id="code-${index}">
                            <button class="copy-button" onclick='copyCode(${index})'>üìã Copy</button>
                            <pre id="code-content-${index}"></pre>
                        </div>
                    </div>
                `}).join('');

                testCaseCount.textContent = `${parsedTestCases.length} test cases`;
            }

            if (modelInfo_text) {
                modelInfo.textContent = `Generated using: ${modelInfo_text}`;
            }

            results.style.display = 'block';
            results.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Generate Playwright code for a test case
        window.generatePlaywrightCode = function(index, testCase) {
            const codeBlock = document.getElementById(`code-${index}`);
            const codeContent = document.getElementById(`code-content-${index}`);

            // Hide any other open code blocks
            document.querySelectorAll('.code-block').forEach(block => {
                if (block.id !== `code-${index}`) {
                    block.style.display = 'none';
                }
            });

            const testName = (testCase.title || 'Test Case')
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '_')
                .substring(0, 50);

            let playwrightCode = `// üé≠ Playwright Test: ${testCase.title || 'Test Case'}
import { test, expect } from '@playwright/test';

test('${testCase.title || 'Test Case'}', async ({ page }) => {
    // Navigate to the application
    await page.goto('https://example.com'); // TODO: Update with your URL
    await page.waitForLoadState('networkidle');

`;

            if (testCase.preconditions) {
                playwrightCode += `    // Preconditions: ${testCase.preconditions}\n`;
            }

            if (testCase.steps && testCase.steps.length > 0) {
                playwrightCode += `\n    // Test Steps:\n`;
                testCase.steps.forEach(step => {
                    if (step.toLowerCase().includes('navigate') || step.toLowerCase().includes('go to')) {
                        playwrightCode += `    // ${step}\n`;
                        playwrightCode += `    // await page.goto('https://example.com/page');\n\n`;
                    }
                    else if (step.toLowerCase().includes('click')) {
                        playwrightCode += `    // ${step}\n`;
                        playwrightCode += `    // await page.click('selector'); // TODO: Update selector\n\n`;
                    }
                    else if (step.toLowerCase().includes('enter') || step.toLowerCase().includes('type') || step.toLowerCase().includes('fill')) {
                        playwrightCode += `    // ${step}\n`;
                        playwrightCode += `    // await page.fill('selector', 'value'); // TODO: Update selector and value\n\n`;
                    }
                    else {
                        playwrightCode += `    // ${step}\n`;
                        playwrightCode += `    // TODO: Implement this step\n\n`;
                    }
                });
            }

            playwrightCode += `    // Assertion: ${testCase.expected || 'Verify expected result'}\n`;
            playwrightCode += `    // await expect(page.locator('selector')).toBeVisible(); // TODO: Update assertion\n`;
            playwrightCode += `\n    // Take screenshot for debugging\n`;
            playwrightCode += `    await page.screenshot({ path: 'test-results/${testName}.png' });\n`;
            playwrightCode += `});`;

            codeContent.textContent = playwrightCode;
            codeBlock.style.display = 'block';
        };

        // Copy code to clipboard
        window.copyCode = function(index) {
            const codeContent = document.getElementById(`code-content-${index}`);
            navigator.clipboard.writeText(codeContent.textContent)
                .then(() => {
                    const copyBtn = document.querySelector(`#code-${index} .copy-button`);
                    const originalText = copyBtn.textContent;
                    copyBtn.textContent = '‚úÖ Copied!';
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                    }, 2000);
                })
                .catch(() => {
                    alert('Failed to copy code');
                });
        };

        // Main generate function
        generateBtn.addEventListener('click', async () => {
            const feature = featureInput.value.trim();

            if (!feature) {
                alert('Please describe a feature first!');
                featureInput.focus();
                return;
            }

            loading.style.display = 'block';
            results.style.display = 'none';
            connectionStatus.style.display = 'none';
            generateBtn.disabled = true;

            try {
                console.log('üì§ Sending request to:', `${baseUrl}/api/generate-tests`);
                console.log('üìù Feature:', feature);

                const response = await fetch(`${baseUrl}/api/generate-tests`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ featureDescription: feature })
                });

                console.log('üì• Response status:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('‚úÖ Response received:', data);

                if (data.success) {
                    displayTestCases(data.testCases, data.feature, data.model);
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                connectionStatus.className = 'connection-status error';
                connectionStatus.innerHTML = `‚ùå Failed to connect to ${baseUrl}<br>Error: ${error.message}<br>Make sure backend is running on port 3000`;
            } finally {
                loading.style.display = 'none';
                generateBtn.disabled = false;
            }
        });

        // Keyboard shortcut (Ctrl/Cmd + Enter)
        featureInput.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                generateBtn.click();
            }
        });

        // Auto-test connection on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                fetch(`${baseUrl}/api/health`)
                    .then(response => response.json())
                    .then(data => {
                        connectionStatus.className = 'connection-status success';
                        connectionStatus.innerHTML = `‚úÖ Connected to ${baseUrl}`;
                    })
                    .catch(error => {
                        connectionStatus.className = 'connection-status error';
                        connectionStatus.innerHTML = `‚ùå Cannot connect to ${baseUrl}. Make sure server is running.`;
                    });
            }, 1000);
        });
    </script>
</body>
</html>
